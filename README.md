# Код для исследования:

```
public class Main {
    public static void main(String[] args) {
        int i = 1;                      // 1
        Object o = new Object();        // 2
        Integer ii = 2;                 // 3
        printAll(o, i, ii);             // 4
        System.out.println("finished"); // 7
    }

    private static void printAll(Object o, int i, Integer ii) {
        Integer uselessVar = 700;                   // 5
        System.out.println(o.toString() + i + ii);  // 6
    }
}
```

# Что же происходит внутри?

## Class loader

Выполнение кода всегда начинается с загрузки классов. Код анализируется JVM, выделяются используемые классы.
Направляется запрос на загрузку найденных классов в подсистему загрузки классов.

*Она состоит из трех уровней:*

* Bootstrap ClassLoader;
* Platform ClassLoader;
* Application ClassLoader.

Класс Main и различные системные классы загружаются в область памяти, которая называется **Metaspace**.
После того как классы будут загружены, наступит стадия связывания, состоящая из трех этапов:

1. Верификация - проверка валидности кода;
2. Подготовка - подготовка примитивов в статических полях;
3. Разрешение символьных ссылок - связывание ссылок на другие классы;

## Этап инициализации

Далее последует этап инициализации, во время которого будут выполнены *static* инициализаторы и инициализаторы
*static-полей*.

При дальнейшем выполнении кода, в памяти будет выделено место для хранения информации.

*Для этого существуют две
области памяти:*

**Heap** - хранит ссылочные типы данных;

**Stack** - хранит примитивные типы данных и ссылки на heap для ссылочных типов данных.

## Построчный разбор выделения памяти

1. ```public static void main(String[] args)``` - создание фрейма для метода main в Stack;
2. ```int i = 1;``` - создание переменной, присваивание ей значения и помещения ее во фрейм main;
3. ```Object o = new Object();``` - создание в Heap объекта Object. Во фрейм main поместится переменная, которая
   содержит ссылку на данный объект;
4. ```Integer ii = 2;``` - создание в Heap объекта Integer. Во фрейм main поместится переменная, которая
   содержит ссылку на данный объект;
5. ```printAll(o, i, ii);``` - создание нового фрейма для метода printAll в Stack. В него помещается переменная *o*,
   содержащая ссылку на объект Object, переменная *ii*, содержащая ссылку на объект Integer и переменная *i*, которой
   присваивается значение переменной *i* из фрейма метода main;
6. ```Integer uselessVar = 700;``` - в Heap создается объект Integer. Во фрейм printAll помещается переменная
   uselessVar, хранящая ссылку на этот объект;
7. ```System.out.println(o.toString() + i + ii);``` - создание нового фрейма для метода println в Stack. В него
   помещается переменная *i*, которой присваивается значение и переменная *ii*, содержащая ссылку на объект Integer.
   Создание нового фрейма метода toString со ссылкой на *о* Object. Фрейм toString удаляется после выполнения. Затем
   удаляется из стека фрейм метода println, после него из стека удалится фрейм метода printAll;
8. ```System.out.println("finished");``` - создание нового фрейма для метода println в Stack. В него помещается
   переменная, которой присваивается значение "finished". Фрейм метода println удаляется после выполнения, после него
   удалится фрейм метода main.

Во время выполнения кода, сборщик мусора периодически проверяет Heap на наличие объектов, на которые больше нет
ссылок (объект больше не используется) и удаляет их.
